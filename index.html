<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Texture Align GUI (Minecraft coords) — Three.js</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Monda:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./style.css" />
</head>
<body>
  <div class="app">
    <aside class="sidebar">

      <div class="brand">
        <div class="brand__title">Texture Align</div>
        <div class="brand__subtitle">Minecraft-style coordinates • overlay match</div>
      </div>

      <details open>
        <summary>Camera / Overlay</summary>
        <div class="row tp-row">
          <label class="tp-label">
            Teleport (/tp)
            <input id="tpInput" type="text" spellcheck="false" placeholder="/tp @p 10 20 30 90 0" />
          </label>
          <button id="tpGo" type="button" title="Parse the /tp command and move the camera">Teleport</button>
          <span id="tpMsg" class="hint" aria-live="polite"></span>
        </div>
        <div class="row">
          <label>X <input id="camX" type="number" step="0.01" value="0" /></label>
          <label>Y <input id="camY" type="number" step="0.01" value="0" /></label>
          <label>Z <input id="camZ" type="number" step="0.01" value="0" /></label>
          <label>Yaw <input id="yaw" type="number" step="0.1" value="0" /></label>
          <label>Pitch <input id="pitch" type="number" step="0.1" value="0" /></label>
          <label>FOV <input id="fov" type="number" step="0.1" value="70" /></label>
        </div>

        <div class="row fov-nudge">
          <div class="fov-warning">Use nudge toggle if using an old Minecraft screenshot with in-game F3 coords to account for camera nudge</div>
          <label class="toggle"><input id="oldCamNudge" type="checkbox" /> Old Minecraft camera nudge (+0.05)</label>
        <label class="toggle"><input id="reallyOldCamNudge" type="checkbox" /> Really old Minecraft camera nudge (-0.10)</label>
        </div>

        <div class="row">
          <label class="toggle"><input id="useFeetY" type="checkbox" checked /> Feet Y (Minecraft XYZ)</label>
          <label class="toggle"><input id="centerTpXZ" type="checkbox" /> Center X/Z integers (.5)</label>
          <!-- Resolution is still used internally, but the inputs are hidden to reduce UI clutter. -->
          <input id="viewW" type="hidden" value="960" />
          <input id="viewH" type="hidden" value="540" />
          <label>Render W <input id="renderW" type="number" step="1" value="960" /></label>
          <label>Render H <input id="renderH" type="number" step="1" value="540" /></label>
          <button id="applyViewSize" type="button">Apply resolution</button>
          <button id="sizeToOverlay" type="button" title="Set resolution to the loaded overlay image">Size = overlay</button>
          <label class="file">
            Overlay image (any size)
            <input id="overlayFile" type="file" accept="image/png,image/jpeg,image/bmp,.bmp" />
          </label>
          <label>Overlay opacity <input id="overlayOpacity" type="range" min="0" max="1" step="0.01" value="0.65" /></label>
          <label>Texture opacity <input id="grassOpacity" type="range" min="0" max="1" step="0.01" value="1" /></label>
          <label><input id="showOverlay" type="checkbox" checked /> Show overlay</label>
          <label><input id="showGrid" type="checkbox" checked /> Show grid</label>
          <label class="range">
            Grid radius <span id="gridRadiusLabel">4</span>
            <input id="gridRadius" type="range" min="2" max="64" step="1" value="4" />
          </label>
          <label><input id="showGrass" type="checkbox" checked /> Show texture overlay</label>
          <span class="hint">Camera mouse-look is disabled. Use the numeric camera inputs above.</span>
        </div>

        <div class="readout" id="readout"></div>
      </details>

      <details open>
        <summary>Texture Align</summary>
        <div class="row">
          <div class="kbdhelp">
            <div><b>Left click</b>: select offset</div>
            <div><b>Right click</b>: enter placement mode</div>
            <div><b>Right click again</b>: confirm placement</div>
            <div><b>WASD / arrow keys</b>: move the selected offset X/Z (snaps to valid steps)</div>
            <div><b>R / F</b>: adjust offset Y (0–15)</div>
            <div><b>Enter</b>: confirm selection (no-op, keeps values)</div>
          </div>
        </div>



        <div class="row">
          <label>Offset X (<span id="offXRange">0–15</span>) <input id="offX" type="number" min="0" max="15" step="1" value="7" /></label>
          <label>Offset Y (0–15) <input id="offY" type="number" min="0" max="15" step="1" value="7" /></label>
          <label>Offset Z (<span id="offZRange">0–15</span>) <input id="offZ" type="number" min="0" max="15" step="1" value="7" /></label>
          <button id="applyOffsets" type="button">Apply to selected</button>
          <button id="centerOffsets" type="button">Center (7,7,7)</button>
        </div>

        <div id="dripstoneOffsetNote" class="foliage-variant hidden" title="Pointed dripstone offset precision">
          <div style="font-size: 12px; opacity: 0.9; line-height: 1.3;">
            <b>Pointed dripstone note:</b> edge offsets are <b>not uniquely recoverable</b> (vanilla collapses 0–3 and 12–15 into the same final position).
            For best cracking accuracy, prefer dripstone that’s closer to the <b>center</b> of a block.
          </div>
        </div>

        <div class="row">
          <label>X <input id="selBlockX" type="number" step="1" value="0" /></label>
          <label>Y <input id="selBlockY" type="number" step="1" value="0" /></label>
          <label>Z <input id="selBlockZ" type="number" step="1" value="0" /></label>
          <button id="applySelBlock" type="button">Set selected block</button>
          <span class="hint">Moves the currently selected texture to a new block (keeps its offsets).</span>
        </div>

        <div class="row">
          <label>Offset list</label>
          <select id="grassList" size="8" class="list"></select>
        </div>

        <div class="row">
          <button id="exportOffsets" type="button">Export offsets</button>
          <button id="clearGrass" type="button">Clear</button>
          <span class="hint">Export format: <code>blockX blockY blockZ  offX offY offZ KIND</code> (one per line)</span>
        </div>

        <div class="row" style="margin-top:10px;">
          <label for="grassDataIn">Offset data input (strict)</label>
          <span class="hint">Paste lines in format: <code>blockX blockY blockZ  offX offY offZ KIND</code> (KIND optional; offsets 0–15)</span>
        </div>
        <textarea id="grassDataIn" spellcheck="false" placeholder="e.g.
123 64 -20  7 7 7
124 64 -20  3 7 12"></textarea>
        <div class="row">
          <button id="loadGrassData">Load offset data</button>
        </div>

        <textarea id="exportBox" spellcheck="false" placeholder="Export will appear here…"></textarea>

        <div class="crack">
          <div class="row">
            <label>Version
              <select id="crackVersion">
                <option value="post1_12" selected>Newer versions</option>
                <option value="postb1_5">Old versions</option>
              </select>
            </label>
            <label>Center X <input id="crackCenterX" type="number" step="1" value="0" /></label>
            <label>Center Z <input id="crackCenterZ" type="number" step="1" value="0" /></label>
            <label>Radius <input id="crackRadius" type="number" step="1" value="256" /></label>
          </div>

          <label class="row">
            <span>Match mode</span>
            <select id="matchMode">
              <option value="strict">Strict (exact)</option>
              <option value="scored">Allow user error (scored)</option>
            </select>
          </label>

          <label class="row">
            <span>Offset tolerance (snaps)</span>
            <input type="range" id="tolerance" min="0" max="2" value="1">
            <span id="tolVal">1</span>
          </label>

          <p id="warn" class="warning hidden">
            Scored mode allows small mistakes. Use more offset samples for accuracy
          </p>

          <div class="row">
            <label>Y min <input id="crackYMin" type="number" step="1" value="62" /></label>
            <label>Y max <input id="crackYMax" type="number" step="1" value="70" /></label>
            <label class="inline"><input id="crackWorkers" type="checkbox" checked /> Use multiple CPU cores</label>
            <button id="crackCoords" type="button">Crack coordinates</button>
            <span id="crackStatus" class="hint">Uses current offset data (no need to export).</span>
          </div>
          <textarea id="crackOut" spellcheck="false" placeholder="Possible coordinates will appear here…"></textarea>
        </div>

      </details>

    </aside>

    <main class="workspace" aria-label="Workspace">
      <div class="viewport" aria-label="Viewport (960×540)">
        <div class="canvas-topright">
          <label class="toggle progart"><input id="progArtToggle" type="checkbox" /> Programmer Art</label>
          <label class="toggle msaa" title="Multisample anti-aliasing"><input id="msaaToggle" type="checkbox" checked /> MSAA</label>
        </div>
      <canvas id="view" width="960" height="540"></canvas>
      <div class="foliage-picker" title="Choose which texture type you are placing">
        <label>Textures
          <select id="foliageSelect"></select>
        </label>
        <div id="bambooUvControls" class="variant-controls hidden" title="Bamboo UV shift (matches in-game random bamboo texture offsets)">
          <label>Bamboo U
            <input id="bambooUvU" type="number" min="0" max="15" step="1" value="0"/>
          </label>
          <label>Bamboo V
            <input id="bambooUvV" type="number" min="0" max="15" step="1" value="0"/>
          </label>
          <label>Bamboo model
            <select id="bambooModelSize">
              <option value="2x2" selected>2×2</option>
              <option value="3x3">3×3</option>
            </select>
          </label>
        </div>
        <div id="variantControls" class="variant-controls hidden">
          <label id="heightLabel">Height
            <input id="variantHeight" type="number" min="1" max="16" step="1" value="1"/>
          </label>
          <label id="dirLabel">Direction
            <select id="variantDir">
              <option value="up">up</option>
              <option value="down">down</option>
            </select>
          </label>
        </div>

        <div id="propaguleControls" class="variant-controls hidden" title="Mangrove propagule model">
          <label>Propagule model
            <select id="propaguleModel">
              <option value="ground">ground</option>
              <option value="hanging_0">hanging0</option>
              <option value="hanging_1">hanging1</option>
              <option value="hanging_2">hanging2</option>
              <option value="hanging_3">hanging3</option>
              <option value="hanging_4">hanging4</option>
            </select>
          </label>
        </div>
        <div id="cubeControls" class="variant-controls hidden" title="Cube block texture">
          <label>Block type
            <select id="cubeBlockType">
              <option value="GRASS_BLOCK" selected>grass block</option>
              <option value="DIRT">dirt</option>
              <option value="STONE">stone block</option>
              <option value="PODZOL">podzol</option>
              <option value="DIRT_PATH">dirt path</option>
              <option value="COARSE_DIRT">coarse dirt</option>
              <option value="ROOTED_DIRT">rooted dirt</option>
              <option value="DRIPSTONE_BLOCK">dripstone block</option>
            </select>
          </label>
        </div>
      </div>
      <div id="texIndicator" class="tex-indicator">Grass texture: Jappa</div>
      <div class="badge">
        <div><span class="swatch grid"></span> Grid (light gray)</div>
        <div><span class="swatch chunk"></span> Chunk borders (yellow)</div>
        <div><span class="swatch sel"></span> Selected texture</div>
      </div>
      </div>
      <div class="workspace__hint">Scroll = zoom • Hold left click + drag = pan • Right click = place mode • WASD/Arrows = move offset • DEL = delete selected</div>
      <div class="workspace__help">
        <div><b>Placement:</b> right click to start, move mouse to snap X/Z, use <b>R/F</b> for Y, right click again to confirm.</div>
        <div><b>Selection:</b> left click a texture to select it (selection is tinted).</div>
      </div>
    </main>
  </div>

  <footer class="repos" aria-label="Repositories">
    <div class="repos__title">Repositories used/referenced</div>
    <a href="https://github.com/polymetric/mcah-manualgrass" target="_blank" rel="noreferrer">polymetric/mcah-manualgrass</a>
    <a href="https://github.com/humhue/grassfinder" target="_blank" rel="noreferrer">humhue/grassfinder</a>
    <a href="https://github.com/Gaider10/PerspectiveReverser" target="_blank" rel="noreferrer">Gaider10/PerspectiveReverser</a>
    <a href="https://fonts.google.com/specimen/Monda" target="_blank" rel="noreferrer">Google Fonts: Monda</a>
  </footer>

  <a class="gpt-credit" href="https://github.com/beachale/Offset-to-Coordinate-GUI" target="_blank" rel="noreferrer" aria-label="Grassfinder GitHub">
    Offsetfinder code optimized by GPT
  </a>

  <script type="module" src="./main.js"></script>
</body>
</html>
